    /** @jsx React.DOM */       React.initializeTouchEvents(true);        var TouchMixin = {      touched: false,      handleTouch: function(fn) {        this.touched = true;        typeof fn === 'string' ? this[fn]() : this.touchedOrClicked(fn);      },      handleClick: function(fn) {        if (this.touched) return this.touched = false;        typeof fn === 'string' ? this[fn]() : this.touchedOrClicked(fn);      }    };        var newElement = React.createClass({        ajaxAdd: function(){                    onreturn   = this.props.onreturn;                    toTheCheck = this.props.toTheCheck;                    var name   = this.refs.itemName.getDOMNode().value.trim();                    var price  = this.refs.itemPrice.getDOMNode().value.trim();                     toParse    = {name: name, price:price};                    $.post( "newCheckElement.php", toParse, function(data) {                        data = JSON.parse(data);                        if (data.success == true) {                            onreturn(data.id);                        } else {                            console.log('Чувак, аджакс по пизде пошёл, хуйня какая-то на выходе получилась.');                        }                    });        },        render: function(){            return (                    <div>                            <div className="div-like-li">                                <input type="text" name="itemName" ref="itemName" placeholder="Winston Compact"/>                                <br/>                                <input type="number" name="itemPrice" ref="itemPrice" step="any" placeholder="67.00"/>&#8381;                            </div>                            <div className="clear"></div>                            <div className="order-buttons">                            <button onClick={this.ajaxAdd}>Добавить</button>                            </div>                    </div>                );        }    });    var menuElement = React.createClass({    mixins: [TouchMixin],        touchedOrClicked: function(){            this.props.onClick(this.props.ref);        },         render: function(){            return (                    <li onClick={ this.handleClick } onTouchEnd={ this.handleTouch }>                        <span>{this.props.name}</span><strong>{this.props.quanity}</strong>                        <br/>                        <br/>                        <i>{this.props.price}&#8381;</i>                       </li>                );        }    });    var menuAndOrder = React.createClass({        getInitialState: function(){            return { total: 0, menuElements: [], orderElements: [], menuCategories: []};        },                kEbenyam: function(){            var menuElements = this.state.menuElements;            menuElements.map(function(e){                e.quanity = 0            });            this.setState({menuElements: menuElements, orderElements: [], total: 0 });        },        proceed: function(){            var orderElements = this.state.orderElements;                if (confirm('Вообще сто пудово?')) {                    var toParse = [];                    var idset = '';                             var cash;                    if (orderElements.length != 0) {                        for (var i = 0; i < orderElements.length; i++) {                            idset += '.' + orderElements[i].id;                            while (orderElements[i].quanity != 1){                                idset += '.' + orderElements[i].id;                                orderElements[i].quanity--;                            }                            // FIX                        }                    idset = idset.substring(1);                    }                    barista = document.getElementById('barista_id').value;                    cash = this.state.total;                    toParse = {idset:idset, cash:cash, barista:barista};                                        $.post( "saveOutcomeCheck.php", toParse, function(data) {                        var tooltip;                        var text;                        text    = document.getElementById('tooltipText');                        tooltip = document.getElementById('tooltip');                        tooltip.style.display = 'inline';                        text.innerHTML = data;                    });                this.kEbenyam();            }        },        getAndInit: function(id){            var self = this;            var url  = 'getJsonRawMaterials.php';            $.getJSON(url, function(result){                elements   = result;            if(!elements || !elements.length){                return;            }                var menuElements = elements.map(function(p){                    return {                        id: p.id,                        name: p.name,                        price: p.price,                        quanity: 0                    };                });                self.setState({ menuElements: menuElements });                if (typeof id != 'undefined') {                    self.menuElementClick(id);                }            });        },        componentDidMount: function(){            this.getAndInit();        },        menuElementClick: function(id){            var orderElements     = this.state.orderElements,                menuElements      = this.state.menuElements,                total             = this.state.total,                inOrdersAlready   = false;            for (var i = 0; i < orderElements.length; i++) {                if (orderElements[i].id == id) {                        inOrdersAlready = true;                    break;                }            }            for (var i = 0; i < menuElements.length; i++) {                if (menuElements[i].id == id) {                    menuElements[i].quanity +=1;                    if (!inOrdersAlready){                        orderElements.push(menuElements[i]);                    }                    total += Number(menuElements[i].price);                    break;                }            }            this.setState({menuElements: menuElements, orderElements: orderElements, total: total});        },        orderElementClick: function(id){            var orderElements = this.state.orderElements,                menuElements  = this.state.menuElements,                total         = this.state.total;            for (var i = 0; i < orderElements.length; i++) {                if (orderElements[i].id == id) {                    total -= Number(orderElements[i].price);                    orderElements[i].quanity -= 1;                    if (orderElements[i].quanity == 0){                        orderElements.splice(i, 1);                    }                     break;                }            }            this.setState({menuElements: menuElements, orderElements: orderElements, total: total});        },        render: function(){            var self = this;            var menuElements     = this.state.menuElements;                menuElements     = menuElements.map(function(s){                    return <menuElement ref={s.id} name={s.name} price={s.price} onClick={self.menuElementClick} />;                });                                           if(!menuElements.length){                menuElements = <div><br/><br/><p>Загрузка данных с сервера...</p></div>;            }            var orderElements = this.state.orderElements.map(function(s){                return <menuElement ref={s.id} name={s.name} price={(s.price*s.quanity).toFixed(2)} quanity={s.quanity} onClick={self.orderElementClick} />;            });            if(!orderElements.length){                orderElements = <div className="order-war"><i>Сформируйте чек</i></div>;            }            return (                <div>                    <div className="menu-items">                        <div className="category-separator"><br/><h5>Прошлые покупки:</h5><br/></div>                        <ul id="list-of-items-in-stock">                            {menuElements}                        </ul>                        <div className="clear"></div>                    </div>                    <div>                        <h5>...или новый товар:</h5>                        <newElement onreturn={this.getAndInit} toTheCheck={self.menuElementClick} />                    </div>                    <br/>                    <div className="order">                        <h3 className="main-title">Чек</h3>                         <ul id="order-list">                            {orderElements}                            <div className="clear"></div>                        </ul>                        <strong>Чек: {this.state.total.toFixed(2)}</strong>&#8381                       <div className="order-buttons">                        <button onClick={this.kEbenyam}>Очистить чек</button>                        <button onClick={this.proceed}>Подтвердить</button>                       </div>                    </div>                </div>            );        }    });        React.renderComponent(        <menuAndOrder/>,        document.getElementById('menu-react-mount')    );